import ddf.minim.analysis.*;
import ddf.minim.*;

int xpos = 50;
int ypos = 50;
int w = 100;
int h = 80;
int mover = 5;
int score = 0;
int highscore;

color red = color(255,0,0);
color white = color(255);
color black = color(0);
color gray = color(204);
color blue = color(0,0,255);
color bgcolor = color(255);

int framew = 1024;
int frameh = 768;

PrintWriter output;
PrintWriter Scoreout;
String[] data;
String[] hs;
PFont font;

Minim       minim;
AudioPlayer jingle;
FFT         fft;
void setup()
{
  size(framew, frameh);
  hs = loadStrings("HighScore.txt");
  Scoreout = createWriter("HighScore.txt");
  font = loadFont("TitleFont.vlw");
  background(bgcolor);
  highscore = Integer.parseInt(hs[0]);
  
  minim = new Minim(this);
  jingle = minim.loadFile("NeverFull.mp3", 1024);
  jingle.loop();
  fft = new FFT( jingle.bufferSize(), jingle.sampleRate() );
}

void draw()
{
  fill(white);
  rect(0,0,framew,frameh);
  
  textFont(font);
  fill(black);
  textAlign(CENTER);
  
  text("Keep the cursor on the box", framew/2, 250);
  text("Score: " + score, framew/2, 350);
  text("High Score: " + highscore, framew/2, 450);
  
  textFont(font,24);
  text("Reset High Score", framew/2, 550);
  
  if((mouseX > (framew/2)-45 && mouseX < ((framew/2)-45)+90) && (mouseY > 580 && mouseY < 580+50))
    fill(100,100,255);
    
  else
    fill(blue);
    
  rect((framew/2)-45, 580, 90, 50);
  
  if(score == 0)
    if(mover > 0)
      mover = 5;
    else
      mover = -5;
  if(score == 500)
    if(mover > 0)
      mover = 6;
    else
      mover = -6;
  if(score == 800)
    if(mover > 0)
      mover = 7;
    else
      mover = -7;
  
  xpos = xpos + mover;
  if(xpos > (framew-w) || xpos < 0)
    mover = -mover;
    
  if((mouseX > xpos && mouseX < xpos+w) && (mouseY > ypos && mouseY < ypos+h))
  {
    fill(255,100,100);
    score = score + 1;
    if(score >= highscore)
      highscore = score;
  }
  
  else
  {
    fill(red);
    score = 0;
  }
  
  rect(xpos, ypos, w, h);
  
  fft.forward( jingle.mix );
  
  for(int i = 0; i < fft.specSize(); i++)
    line( i, height, i, height - fft.getBand(i)*8 );
    
  for(int j = framew; j > framew-fft.specSize(); j--)
    line( j, height, j, height - fft.getBand((-1*(j-framew)))*8 );
}

void mousePressed()
{
  if((mouseX > (framew/2)-45 && mouseX < ((framew/2)-45)+90) && (mouseY > 580 && mouseY < 580+50))
    highscore = 0;
}

void exit()
{
  println("Thanks for Playing!!");
  
  if(score > highscore)
    Scoreout.print(score);
    
  else
    Scoreout.print(highscore);
    
  Scoreout.flush();
  Scoreout.close();
  super.exit();
}
